var wt=Object.defineProperty;var Ne=e=>{throw TypeError(e)};var vt=(e,t,r)=>t in e?wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var d=(e,t,r)=>vt(e,typeof t!="symbol"?t+"":t,r),He=(e,t,r)=>t.has(e)||Ne("Cannot "+r);var i=(e,t,r)=>(He(e,t,"read from private field"),r?r.call(e):t.get(e)),g=(e,t,r)=>t.has(e)?Ne("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),f=(e,t,r,s)=>(He(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),w=(e,t,r)=>(He(e,t,"access private method"),r);var Me=(e,t,r,s)=>({set _(n){f(e,t,n,r)},get _(){return i(e,t,s)}});var Te=(e,t,r)=>(s,n)=>{let o=-1;return c(0);async function c(l){if(l<=o)throw new Error("next() called multiple times");o=l;let a,h=!1,u;if(e[l]?(u=e[l][0][0],s.req.routeIndex=l):u=l===e.length&&n||void 0,u)try{a=await u(s,()=>c(l+1))}catch(p){if(p instanceof Error&&t)s.error=p,a=await t(p,s),h=!0;else throw p}else s.finalized===!1&&r&&(a=await r(s));return a&&(s.finalized===!1||h)&&(s.res=a),s}},Rt=Symbol(),yt=async(e,t=Object.create(null))=>{const{all:r=!1,dot:s=!1}=t,o=(e instanceof rt?e.raw.headers:e.headers).get("Content-Type");return o!=null&&o.startsWith("multipart/form-data")||o!=null&&o.startsWith("application/x-www-form-urlencoded")?Et(e,{all:r,dot:s}):{}};async function Et(e,t){const r=await e.formData();return r?xt(r,t):{}}function xt(e,t){const r=Object.create(null);return e.forEach((s,n)=>{t.all||n.endsWith("[]")?Ot(r,n,s):r[n]=s}),t.dot&&Object.entries(r).forEach(([s,n])=>{s.includes(".")&&(bt(r,s,n),delete r[s])}),r}var Ot=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},bt=(e,t,r)=>{let s=e;const n=t.split(".");n.forEach((o,c)=>{c===n.length-1?s[o]=r:((!s[o]||typeof s[o]!="object"||Array.isArray(s[o])||s[o]instanceof File)&&(s[o]=Object.create(null)),s=s[o])})},Qe=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},mt=e=>{const{groups:t,path:r}=jt(e),s=Qe(r);return Pt(s,t)},jt=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{const n=`@${s}`;return t.push([n,r]),n}),{groups:t,path:e}},Pt=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e},Ee={},St=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const s=`${e}#${t}`;return Ee[s]||(r[2]?Ee[s]=t&&t[0]!==":"&&t[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:Ee[s]=[e,r[1],!0]),Ee[s]}return null},Ie=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},At=e=>Ie(e,decodeURI),Ye=e=>{const t=e.url,r=t.indexOf("/",t.indexOf(":")+4);let s=r;for(;s<t.length;s++){const n=t.charCodeAt(s);if(n===37){const o=t.indexOf("?",s),c=t.slice(r,o===-1?void 0:o);return At(c.includes("%25")?c.replace(/%25/g,"%2525"):c)}else if(n===63)break}return t.slice(r,s)},Ht=e=>{const t=Ye(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},te=(e,t,...r)=>(r.length&&(t=te(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),Ze=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let s="";return t.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){r.length===0&&s===""?r.push("/"):r.push(s);const o=n.replace("?","");s+="/"+o,r.push(s)}else s+="/"+n}),r.filter((n,o,c)=>c.indexOf(n)===o)},$e=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?Ie(e,tt):e):e,et=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let c=e.indexOf(`?${t}`,8);for(c===-1&&(c=e.indexOf(`&${t}`,8));c!==-1;){const l=e.charCodeAt(c+t.length+1);if(l===61){const a=c+t.length+2,h=e.indexOf("&",a);return $e(e.slice(a,h===-1?void 0:h))}else if(l==38||isNaN(l))return"";c=e.indexOf(`&${t}`,c+1)}if(s=/[%+]/.test(e),!s)return}const n={};s??(s=/[%+]/.test(e));let o=e.indexOf("?",8);for(;o!==-1;){const c=e.indexOf("&",o+1);let l=e.indexOf("=",o);l>c&&c!==-1&&(l=-1);let a=e.slice(o+1,l===-1?c===-1?void 0:c:l);if(s&&(a=$e(a)),o=c,a==="")continue;let h;l===-1?h="":(h=e.slice(l+1,c===-1?void 0:c),s&&(h=$e(h))),r?(n[a]&&Array.isArray(n[a])||(n[a]=[]),n[a].push(h)):n[a]??(n[a]=h)}return t?n[t]:n},$t=et,Ct=(e,t)=>et(e,t,!0),tt=decodeURIComponent,Fe=e=>Ie(e,tt),ne,S,T,st,nt,De,k,We,rt=(We=class{constructor(e,t="/",r=[[]]){g(this,T);d(this,"raw");g(this,ne);g(this,S);d(this,"routeIndex",0);d(this,"path");d(this,"bodyCache",{});g(this,k,e=>{const{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;const n=Object.keys(t)[0];return n?t[n].then(o=>(n==="json"&&(o=JSON.stringify(o)),new Response(o)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,f(this,S,r),f(this,ne,{})}param(e){return e?w(this,T,st).call(this,e):w(this,T,nt).call(this)}query(e){return $t(this.url,e)}queries(e){return Ct(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await yt(this,e))}json(){return i(this,k).call(this,"text").then(e=>JSON.parse(e))}text(){return i(this,k).call(this,"text")}arrayBuffer(){return i(this,k).call(this,"arrayBuffer")}blob(){return i(this,k).call(this,"blob")}formData(){return i(this,k).call(this,"formData")}addValidatedData(e,t){i(this,ne)[e]=t}valid(e){return i(this,ne)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[Rt](){return i(this,S)}get matchedRoutes(){return i(this,S)[0].map(([[,e]])=>e)}get routePath(){return i(this,S)[0].map(([[,e]])=>e)[this.routeIndex].path}},ne=new WeakMap,S=new WeakMap,T=new WeakSet,st=function(e){const t=i(this,S)[0][this.routeIndex][1][e],r=w(this,T,De).call(this,t);return r&&/\%/.test(r)?Fe(r):r},nt=function(){const e={},t=Object.keys(i(this,S)[0][this.routeIndex][1]);for(const r of t){const s=w(this,T,De).call(this,i(this,S)[0][this.routeIndex][1][r]);s!==void 0&&(e[r]=/\%/.test(s)?Fe(s):s)}return e},De=function(e){return i(this,S)[1]?i(this,S)[1][e]:e},k=new WeakMap,We),Dt={Stringify:1},it=async(e,t,r,s,n)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const o=e.callbacks;return o!=null&&o.length?(n?n[0]+=e:n=[e],Promise.all(o.map(l=>l({phase:t,buffer:n,context:s}))).then(l=>Promise.all(l.filter(Boolean).map(a=>it(a,t,!1,s,n))).then(()=>n[0]))):Promise.resolve(e)},_t="text/plain; charset=UTF-8",Ce=(e,t)=>({"Content-Type":e,...t}),pe,ge,I,ie,L,b,we,oe,ae,V,ve,Re,U,re,Ke,It=(Ke=class{constructor(e,t){g(this,U);g(this,pe);g(this,ge);d(this,"env",{});g(this,I);d(this,"finalized",!1);d(this,"error");g(this,ie);g(this,L);g(this,b);g(this,we);g(this,oe);g(this,ae);g(this,V);g(this,ve);g(this,Re);d(this,"render",(...e)=>(i(this,oe)??f(this,oe,t=>this.html(t)),i(this,oe).call(this,...e)));d(this,"setLayout",e=>f(this,we,e));d(this,"getLayout",()=>i(this,we));d(this,"setRenderer",e=>{f(this,oe,e)});d(this,"header",(e,t,r)=>{this.finalized&&f(this,b,new Response(i(this,b).body,i(this,b)));const s=i(this,b)?i(this,b).headers:i(this,V)??f(this,V,new Headers);t===void 0?s.delete(e):r!=null&&r.append?s.append(e,t):s.set(e,t)});d(this,"status",e=>{f(this,ie,e)});d(this,"set",(e,t)=>{i(this,I)??f(this,I,new Map),i(this,I).set(e,t)});d(this,"get",e=>i(this,I)?i(this,I).get(e):void 0);d(this,"newResponse",(...e)=>w(this,U,re).call(this,...e));d(this,"body",(e,t,r)=>w(this,U,re).call(this,e,t,r));d(this,"text",(e,t,r)=>!i(this,V)&&!i(this,ie)&&!t&&!r&&!this.finalized?new Response(e):w(this,U,re).call(this,e,t,Ce(_t,r)));d(this,"json",(e,t,r)=>w(this,U,re).call(this,JSON.stringify(e),t,Ce("application/json",r)));d(this,"html",(e,t,r)=>{const s=n=>w(this,U,re).call(this,n,t,Ce("text/html; charset=UTF-8",r));return typeof e=="object"?it(e,Dt.Stringify,!1,{}).then(s):s(e)});d(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});d(this,"notFound",()=>(i(this,ae)??f(this,ae,()=>new Response),i(this,ae).call(this,this)));f(this,pe,e),t&&(f(this,L,t.executionCtx),this.env=t.env,f(this,ae,t.notFoundHandler),f(this,Re,t.path),f(this,ve,t.matchResult))}get req(){return i(this,ge)??f(this,ge,new rt(i(this,pe),i(this,Re),i(this,ve))),i(this,ge)}get event(){if(i(this,L)&&"respondWith"in i(this,L))return i(this,L);throw Error("This context has no FetchEvent")}get executionCtx(){if(i(this,L))return i(this,L);throw Error("This context has no ExecutionContext")}get res(){return i(this,b)||f(this,b,new Response(null,{headers:i(this,V)??f(this,V,new Headers)}))}set res(e){if(i(this,b)&&e){e=new Response(e.body,e);for(const[t,r]of i(this,b).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const s=i(this,b).headers.getSetCookie();e.headers.delete("set-cookie");for(const n of s)e.headers.append("set-cookie",n)}else e.headers.set(t,r)}f(this,b,e),this.finalized=!0}get var(){return i(this,I)?Object.fromEntries(i(this,I)):{}}},pe=new WeakMap,ge=new WeakMap,I=new WeakMap,ie=new WeakMap,L=new WeakMap,b=new WeakMap,we=new WeakMap,oe=new WeakMap,ae=new WeakMap,V=new WeakMap,ve=new WeakMap,Re=new WeakMap,U=new WeakSet,re=function(e,t,r){const s=i(this,b)?new Headers(i(this,b).headers):i(this,V)??new Headers;if(typeof t=="object"&&"headers"in t){const o=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[c,l]of o)c.toLowerCase()==="set-cookie"?s.append(c,l):s.set(c,l)}if(r)for(const[o,c]of Object.entries(r))if(typeof c=="string")s.set(o,c);else{s.delete(o);for(const l of c)s.append(o,l)}const n=typeof t=="number"?t:(t==null?void 0:t.status)??i(this,ie);return new Response(e,{status:n,headers:s})},Ke),y="ALL",Lt="all",Nt=["get","post","put","delete","options","patch"],ot="Can not add a route since the matcher is already built.",at=class extends Error{},Mt="__COMPOSED_HANDLER",Tt=e=>e.text("404 Not Found",404),ke=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},A,E,ht,H,z,xe,Oe,Be,ct=(Be=class{constructor(t={}){g(this,E);d(this,"get");d(this,"post");d(this,"put");d(this,"delete");d(this,"options");d(this,"patch");d(this,"all");d(this,"on");d(this,"use");d(this,"router");d(this,"getPath");d(this,"_basePath","/");g(this,A,"/");d(this,"routes",[]);g(this,H,Tt);d(this,"errorHandler",ke);d(this,"onError",t=>(this.errorHandler=t,this));d(this,"notFound",t=>(f(this,H,t),this));d(this,"fetch",(t,...r)=>w(this,E,Oe).call(this,t,r[1],r[0],t.method));d(this,"request",(t,r,s,n)=>t instanceof Request?this.fetch(r?new Request(t,r):t,s,n):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${te("/",t)}`,r),s,n)));d(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(w(this,E,Oe).call(this,t.request,t,void 0,t.request.method))})});[...Nt,Lt].forEach(o=>{this[o]=(c,...l)=>(typeof c=="string"?f(this,A,c):w(this,E,z).call(this,o,i(this,A),c),l.forEach(a=>{w(this,E,z).call(this,o,i(this,A),a)}),this)}),this.on=(o,c,...l)=>{for(const a of[c].flat()){f(this,A,a);for(const h of[o].flat())l.map(u=>{w(this,E,z).call(this,h.toUpperCase(),i(this,A),u)})}return this},this.use=(o,...c)=>(typeof o=="string"?f(this,A,o):(f(this,A,"*"),c.unshift(o)),c.forEach(l=>{w(this,E,z).call(this,y,i(this,A),l)}),this);const{strict:s,...n}=t;Object.assign(this,n),this.getPath=s??!0?t.getPath??Ye:Ht}route(t,r){const s=this.basePath(t);return r.routes.map(n=>{var c;let o;r.errorHandler===ke?o=n.handler:(o=async(l,a)=>(await Te([],r.errorHandler)(l,()=>n.handler(l,a))).res,o[Mt]=n.handler),w(c=s,E,z).call(c,n.method,n.path,o)}),this}basePath(t){const r=w(this,E,ht).call(this);return r._basePath=te(this._basePath,t),r}mount(t,r,s){let n,o;s&&(typeof s=="function"?o=s:(o=s.optionHandler,s.replaceRequest===!1?n=a=>a:n=s.replaceRequest));const c=o?a=>{const h=o(a);return Array.isArray(h)?h:[h]}:a=>{let h;try{h=a.executionCtx}catch{}return[a.env,h]};n||(n=(()=>{const a=te(this._basePath,t),h=a==="/"?0:a.length;return u=>{const p=new URL(u.url);return p.pathname=p.pathname.slice(h)||"/",new Request(p,u)}})());const l=async(a,h)=>{const u=await r(n(a.req.raw),...c(a));if(u)return u;await h()};return w(this,E,z).call(this,y,te(t,"*"),l),this}},A=new WeakMap,E=new WeakSet,ht=function(){const t=new ct({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,f(t,H,i(this,H)),t.routes=this.routes,t},H=new WeakMap,z=function(t,r,s){t=t.toUpperCase(),r=te(this._basePath,r);const n={basePath:this._basePath,path:r,method:t,handler:s};this.router.add(t,r,[s,n]),this.routes.push(n)},xe=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},Oe=function(t,r,s,n){if(n==="HEAD")return(async()=>new Response(null,await w(this,E,Oe).call(this,t,r,s,"GET")))();const o=this.getPath(t,{env:s}),c=this.router.match(n,o),l=new It(t,{path:o,matchResult:c,env:s,executionCtx:r,notFoundHandler:i(this,H)});if(c[0].length===1){let h;try{h=c[0][0][0][0](l,async()=>{l.res=await i(this,H).call(this,l)})}catch(u){return w(this,E,xe).call(this,u,l)}return h instanceof Promise?h.then(u=>u||(l.finalized?l.res:i(this,H).call(this,l))).catch(u=>w(this,E,xe).call(this,u,l)):h??i(this,H).call(this,l)}const a=Te(c[0],this.errorHandler,i(this,H));return(async()=>{try{const h=await a(l);if(!h.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return h.res}catch(h){return w(this,E,xe).call(this,h,l)}})()},Be),lt=[];function Ft(e,t){const r=this.buildAllMatchers(),s=(n,o)=>{const c=r[n]||r[y],l=c[2][o];if(l)return l;const a=o.match(c[0]);if(!a)return[[],lt];const h=a.indexOf("",1);return[c[1][h],a]};return this.match=s,s(e,t)}var me="[^/]+",fe=".*",de="(?:|/.*)",se=Symbol(),kt=new Set(".\\+*[^]$()");function Ut(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===fe||e===de?1:t===fe||t===de?-1:e===me?1:t===me?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var X,J,$,qe,_e=(qe=class{constructor(){g(this,X);g(this,J);g(this,$,Object.create(null))}insert(t,r,s,n,o){if(t.length===0){if(i(this,X)!==void 0)throw se;if(o)return;f(this,X,r);return}const[c,...l]=t,a=c==="*"?l.length===0?["","",fe]:["","",me]:c==="/*"?["","",de]:c.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let h;if(a){const u=a[1];let p=a[2]||me;if(u&&a[2]&&(p===".*"||(p=p.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(p))))throw se;if(h=i(this,$)[p],!h){if(Object.keys(i(this,$)).some(v=>v!==fe&&v!==de))throw se;if(o)return;h=i(this,$)[p]=new _e,u!==""&&f(h,J,n.varIndex++)}!o&&u!==""&&s.push([u,i(h,J)])}else if(h=i(this,$)[c],!h){if(Object.keys(i(this,$)).some(u=>u.length>1&&u!==fe&&u!==de))throw se;if(o)return;h=i(this,$)[c]=new _e}h.insert(l,r,s,n,o)}buildRegExpStr(){const r=Object.keys(i(this,$)).sort(Ut).map(s=>{const n=i(this,$)[s];return(typeof i(n,J)=="number"?`(${s})@${i(n,J)}`:kt.has(s)?`\\${s}`:s)+n.buildRegExpStr()});return typeof i(this,X)=="number"&&r.unshift(`#${i(this,X)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},X=new WeakMap,J=new WeakMap,$=new WeakMap,qe),je,ye,ze,Wt=(ze=class{constructor(){g(this,je,{varIndex:0});g(this,ye,new _e)}insert(e,t,r){const s=[],n=[];for(let c=0;;){let l=!1;if(e=e.replace(/\{[^}]+\}/g,a=>{const h=`@\\${c}`;return n[c]=[h,a],c++,l=!0,h}),!l)break}const o=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let c=n.length-1;c>=0;c--){const[l]=n[c];for(let a=o.length-1;a>=0;a--)if(o[a].indexOf(l)!==-1){o[a]=o[a].replace(l,n[c][1]);break}}return i(this,ye).insert(o,t,s,i(this,je),r),s}buildRegExp(){let e=i(this,ye).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,o,c)=>o!==void 0?(r[++t]=Number(o),"$()"):(c!==void 0&&(s[Number(c)]=++t),"")),[new RegExp(`^${e}`),r,s]}},je=new WeakMap,ye=new WeakMap,ze),Kt=[/^$/,[],Object.create(null)],be=Object.create(null);function ut(e){return be[e]??(be[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Bt(){be=Object.create(null)}function qt(e){var h;const t=new Wt,r=[];if(e.length===0)return Kt;const s=e.map(u=>[!/\*|\/:/.test(u[0]),...u]).sort(([u,p],[v,j])=>u?1:v?-1:p.length-j.length),n=Object.create(null);for(let u=0,p=-1,v=s.length;u<v;u++){const[j,C,R]=s[u];j?n[C]=[R.map(([P])=>[P,Object.create(null)]),lt]:p++;let m;try{m=t.insert(C,p,j)}catch(P){throw P===se?new at(C):P}j||(r[p]=R.map(([P,Z])=>{const he=Object.create(null);for(Z-=1;Z>=0;Z--){const[D,Se]=m[Z];he[D]=Se}return[P,he]}))}const[o,c,l]=t.buildRegExp();for(let u=0,p=r.length;u<p;u++)for(let v=0,j=r[u].length;v<j;v++){const C=(h=r[u][v])==null?void 0:h[1];if(!C)continue;const R=Object.keys(C);for(let m=0,P=R.length;m<P;m++)C[R[m]]=l[C[R[m]]]}const a=[];for(const u in c)a[u]=r[c[u]];return[o,a,n]}function ee(e,t){if(e){for(const r of Object.keys(e).sort((s,n)=>n.length-s.length))if(ut(r).test(t))return[...e[r]]}}var W,K,Pe,ft,Ge,zt=(Ge=class{constructor(){g(this,Pe);d(this,"name","RegExpRouter");g(this,W);g(this,K);d(this,"match",Ft);f(this,W,{[y]:Object.create(null)}),f(this,K,{[y]:Object.create(null)})}add(e,t,r){var l;const s=i(this,W),n=i(this,K);if(!s||!n)throw new Error(ot);s[e]||[s,n].forEach(a=>{a[e]=Object.create(null),Object.keys(a[y]).forEach(h=>{a[e][h]=[...a[y][h]]})}),t==="/*"&&(t="*");const o=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const a=ut(t);e===y?Object.keys(s).forEach(h=>{var u;(u=s[h])[t]||(u[t]=ee(s[h],t)||ee(s[y],t)||[])}):(l=s[e])[t]||(l[t]=ee(s[e],t)||ee(s[y],t)||[]),Object.keys(s).forEach(h=>{(e===y||e===h)&&Object.keys(s[h]).forEach(u=>{a.test(u)&&s[h][u].push([r,o])})}),Object.keys(n).forEach(h=>{(e===y||e===h)&&Object.keys(n[h]).forEach(u=>a.test(u)&&n[h][u].push([r,o]))});return}const c=Ze(t)||[t];for(let a=0,h=c.length;a<h;a++){const u=c[a];Object.keys(n).forEach(p=>{var v;(e===y||e===p)&&((v=n[p])[u]||(v[u]=[...ee(s[p],u)||ee(s[y],u)||[]]),n[p][u].push([r,o-h+a+1]))})}}buildAllMatchers(){const e=Object.create(null);return Object.keys(i(this,K)).concat(Object.keys(i(this,W))).forEach(t=>{e[t]||(e[t]=w(this,Pe,ft).call(this,t))}),f(this,W,f(this,K,void 0)),Bt(),e}},W=new WeakMap,K=new WeakMap,Pe=new WeakSet,ft=function(e){const t=[];let r=e===y;return[i(this,W),i(this,K)].forEach(s=>{const n=s[e]?Object.keys(s[e]).map(o=>[o,s[e][o]]):[];n.length!==0?(r||(r=!0),t.push(...n)):e!==y&&t.push(...Object.keys(s[y]).map(o=>[o,s[y][o]]))}),r?qt(t):null},Ge),B,N,Ve,Gt=(Ve=class{constructor(e){d(this,"name","SmartRouter");g(this,B,[]);g(this,N,[]);f(this,B,e.routers)}add(e,t,r){if(!i(this,N))throw new Error(ot);i(this,N).push([e,t,r])}match(e,t){if(!i(this,N))throw new Error("Fatal error");const r=i(this,B),s=i(this,N),n=r.length;let o=0,c;for(;o<n;o++){const l=r[o];try{for(let a=0,h=s.length;a<h;a++)l.add(...s[a]);c=l.match(e,t)}catch(a){if(a instanceof at)continue;throw a}this.match=l.match.bind(l),f(this,B,[l]),f(this,N,void 0);break}if(o===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,c}get activeRouter(){if(i(this,N)||i(this,B).length!==1)throw new Error("No active router has been determined yet.");return i(this,B)[0]}},B=new WeakMap,N=new WeakMap,Ve),ue=Object.create(null),q,O,Q,ce,x,M,G,Xe,dt=(Xe=class{constructor(e,t,r){g(this,M);g(this,q);g(this,O);g(this,Q);g(this,ce,0);g(this,x,ue);if(f(this,O,r||Object.create(null)),f(this,q,[]),e&&t){const s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0},f(this,q,[s])}f(this,Q,[])}insert(e,t,r){f(this,ce,++Me(this,ce)._);let s=this;const n=mt(t),o=[];for(let c=0,l=n.length;c<l;c++){const a=n[c],h=n[c+1],u=St(a,h),p=Array.isArray(u)?u[0]:a;if(p in i(s,O)){s=i(s,O)[p],u&&o.push(u[1]);continue}i(s,O)[p]=new dt,u&&(i(s,Q).push(u),o.push(u[1])),s=i(s,O)[p]}return i(s,q).push({[e]:{handler:r,possibleKeys:o.filter((c,l,a)=>a.indexOf(c)===l),score:i(this,ce)}}),s}search(e,t){var l;const r=[];f(this,x,ue);let n=[this];const o=Qe(t),c=[];for(let a=0,h=o.length;a<h;a++){const u=o[a],p=a===h-1,v=[];for(let j=0,C=n.length;j<C;j++){const R=n[j],m=i(R,O)[u];m&&(f(m,x,i(R,x)),p?(i(m,O)["*"]&&r.push(...w(this,M,G).call(this,i(m,O)["*"],e,i(R,x))),r.push(...w(this,M,G).call(this,m,e,i(R,x)))):v.push(m));for(let P=0,Z=i(R,Q).length;P<Z;P++){const he=i(R,Q)[P],D=i(R,x)===ue?{}:{...i(R,x)};if(he==="*"){const F=i(R,O)["*"];F&&(r.push(...w(this,M,G).call(this,F,e,i(R,x))),f(F,x,D),v.push(F));continue}const[Se,Le,le]=he;if(!u&&!(le instanceof RegExp))continue;const _=i(R,O)[Se],gt=o.slice(a).join("/");if(le instanceof RegExp){const F=le.exec(gt);if(F){if(D[Le]=F[0],r.push(...w(this,M,G).call(this,_,e,i(R,x),D)),Object.keys(i(_,O)).length){f(_,x,D);const Ae=((l=F[0].match(/\//))==null?void 0:l.length)??0;(c[Ae]||(c[Ae]=[])).push(_)}continue}}(le===!0||le.test(u))&&(D[Le]=u,p?(r.push(...w(this,M,G).call(this,_,e,D,i(R,x))),i(_,O)["*"]&&r.push(...w(this,M,G).call(this,i(_,O)["*"],e,D,i(R,x)))):(f(_,x,D),v.push(_)))}}n=v.concat(c.shift()??[])}return r.length>1&&r.sort((a,h)=>a.score-h.score),[r.map(({handler:a,params:h})=>[a,h])]}},q=new WeakMap,O=new WeakMap,Q=new WeakMap,ce=new WeakMap,x=new WeakMap,M=new WeakSet,G=function(e,t,r,s){const n=[];for(let o=0,c=i(e,q).length;o<c;o++){const l=i(e,q)[o],a=l[t]||l[y],h={};if(a!==void 0&&(a.params=Object.create(null),n.push(a),r!==ue||s&&s!==ue))for(let u=0,p=a.possibleKeys.length;u<p;u++){const v=a.possibleKeys[u],j=h[a.score];a.params[v]=s!=null&&s[v]&&!j?s[v]:r[v]??(s==null?void 0:s[v]),h[a.score]=!0}}return n},Xe),Y,Je,Vt=(Je=class{constructor(){d(this,"name","TrieRouter");g(this,Y);f(this,Y,new dt)}add(e,t,r){const s=Ze(t);if(s){for(let n=0,o=s.length;n<o;n++)i(this,Y).insert(e,s[n],r);return}i(this,Y).insert(e,t,r)}match(e,t){return i(this,Y).search(e,t)}},Y=new WeakMap,Je),Xt=class extends ct{constructor(e={}){super(e),this.router=e.router??new Gt({routers:[new zt,new Vt]})}};const Ue=new Xt,Jt=Object.assign({});let pt=!1;for(const[,e]of Object.entries(Jt))e&&(Ue.route("/",e),Ue.notFound(e.notFoundHandler),pt=!0);if(!pt)throw new Error("Can't import modules from ['/src/index.tsx','/app/server.ts']");export{Ue as default};
